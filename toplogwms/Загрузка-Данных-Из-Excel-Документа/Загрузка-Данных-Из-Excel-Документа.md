
# Загрузка данных из Excel документа



### 1. Местонахождение обработки

![Местонахождение-обработки](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Местонахождение-обработки.png?raw=true)





---
### 2. Общие сведения

В приветственном экране имеются элементы:
* [Выбор/Редактирование существующей настройки](#3-редактирование-настройки)
* [Создание новой настройки](#4-создание-настройки)
* [Выполнение загрузки по выбранной настройке](#5-выполнение-загрузки)
* [Формат файла](#6-формат-файла)

![Приветственный-экран](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Приветственный-экран.png?raw=true)




---
### 3. Редактирование настройки

Для редактирования существующей настройки нужно выбрать одну из списка и нажать на кнопку ![Кнопка-Открыть](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Кнопка-Открыть.png?raw=true)

Далее при редактировании настройки можно руководствоваться документацией по [созданию новой настройки](#4-создание-настройки).




---
### 4. Создание настройки

В настройках имеются элементы:
* [Основные настройки](#41-основные-настройки)
* [Настройка элементов дерева](#42-настройка-элементов-дерева)
* [Дополнительные настройки элемента](#43-дополнительные-настройки-элемента)
* [Контекстное меню](#44-контекстное-меню-настройки)
* [Регламентное задание](#45-регламентное-задание)

#### 4.1 Основные настройки

* Наименование.
Название настройки.
* Тип сообщения.
Тип сообщения АОД на загрузку данных. По выбранному типу построится дерево элементов.
* Отправитель.
Участник АОД с ролью **Внешняя система**.
* Получатель.
Участник АОД с ролью **Эта система**.
* Маска файлов. 
Маска по которой будут отбираться файлы из каталога. Рядом есть подсказка по заполнению этой маски.
* Выполнять фоновую загрузку.
Использование фоновой загрузки (см. [Регламентное задание](#45-регламентное-задание)).

![Редактирование-настройки-основные-данные](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Редактирование-настройки-основные-данные.png?raw=true)

#### 4.2 Настройка элементов дерева

Все используемые элементы дерева подствечены зеленым цветом.
Если у элемента есть ошибка заполнения, то он будет подсвечен красным цветом с указанием ошибки.

* Имя свойства.
Элемент из пакета обмена типа сообщения.

* Обязательный.
Флаг является ли этот элемент обязательным для заполнения. 
> Все элементы первого уровня с этим флагом обязательны для заполнения. 

> Все элементы выше первого уровня с этим флагом необязательны к заполнению если родитель этого элемента не используется

* Номер колонки из Excel.
> Если используется заполнение значением из дополнительных настроек, то номер колонки заполнять не требуется

* Дополнительные настройки.
(см. [Дополнительные настройки элемента](#43-дополнительные-настройки-элемента))

![Редактирование-настройки](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Редактирование-настройки.png?raw=true)


#### 4.3 Дополнительные настройки элемента

##### Заполнение значением
В дополнительных настройках элемента возможно указать определенное значение, которое не существует в файле Excel. В этом случае указывать колонку из файла Excel не требуется.

![Дополнительные-настройки-Значение](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Дополнительные-настройки-Значение.png?raw=true)

Виды заполнения значением:
* Постоянное значение. В выбранный элемент будет подставляться заполненное значение.

![Дополнительные-настройки-Значение-постоянное](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Дополнительные-настройки-Значение-постоянное.png?raw=true)

* Уникальный идентификатор. В выбранный элемент будет подставляться заполненное значение новый уникальный идентификатор.

![Дополнительные-настройки-Значение-УИД](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Дополнительные-настройки-Значение-УИД.png?raw=true)

##### Форматная строка
Для некоторых элемент (например тип **Дата**) требуется указать форматную строку через дополнительные настройки. Там где это указывать не надо - эта вкладка будет скрыта.

![Дополнительные-настройки-Форматная-строка](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Дополнительные-настройки-Форматная-строка.png?raw=true)


#### 4.4 Контекстное меню настройки

В редактировании настройки если нажать на кнопку **Еще**, то откроется контекстное меню.
![Контекстное-меню-настройки](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Контекстное-меню-настройки.png?raw=true)

Через данное меню можно:
* Удалить существующую настройку
* Сохранить в файл существующую настройку
* Загрузить из файла существующую настройку

> При загрузке существующей настройки поля **Отправитель** и **Получатель** могут не сопоставиться, поэтому их нужно будет заполнить самому


#### 4.5 Регламентное задание

Для автоматической загрузки файлов excel:
* У настройки во вкладке **Основные данные** должна быть включена галка **Выполнять фоновую загрузку**
* Должен быть настроен регламент **ЗагрузкаExcel**.

Местонахождение регламентных заданий:
![Местонахождение-регламентов](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Местонахождение-регламентов.png?raw=true)

Требуется создать один регламент через кнопку **Добавить** и заполнить элементы так же как на примере:
* Использование - Да
* Наименование - Любое
* Метаданные - ЗагрузкаExcel
* Пользователь - Планировщик

![Настройка-регламентов](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Настройка-регламентов.png?raw=true)

В случае ошибок в журнале регистрации появятся записи под событием **Фоновая загрузка Excel**, уровнем журнала регистрации **Ошибка** и метаданными **РегламентныеЗадания.ЗагрузкаExcel**

![Журнал-регистрации](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Журнал-регистрации.png?raw=true)


---
### 5. Выполнение загрузки

При нажатии на кнопку **Выполнить** произойдет обработка существующих файлов по настройке. 

По окончанию которой пользователю покажется сообщение о том, что загрузка окончена. Так же будет показано количество обработанных файлов и объектов.

![Положительный-результат-загрузки](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Положительный-результат-загрузки.png?raw=true)

В случае ошибок при загрузке появится дополнительное окно с текстом ошибок

![Отрицательный-результат-загрузки](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Отрицательный-результат-загрузки.png?raw=true)

---
### 6. Формат файла

Для загрузки принимаются только файлы с форматами **xls** и **xlsx**.

Первая строка в файле должна обязательно содержать неповторяющиеся имена колонок (для примера указано красным цветом на изображении примера).

Далее само содержание файла начинается со второй строки (для примера указано синим цветом на изображении) 

![Пример-файла](https://github.com/flln23/TopLogWMS-documentation/blob/main/toplogwms/Загрузка-Данных-Из-Excel-Документа/img/Пример-файла.png?raw=true)
